## 环境依赖

需要 Go 1.21 及以上版本。

## 部署步骤

1. 在 Unix 系统中，执行 `make build` 命令编译项目。
2. 执行 `./nts-offset` 命令启动程序。

## 命令行参数

参数说明：
- `--round`：重复运行的轮数，若不指定则默认为 `1`。
- `--input`：输入文件路径，必须指定。
- `--output`：输出文件路径，必须指定。如果文件不存在则创建，存在则将输出添加到文件末尾。
- `--interval`：为防止资源耗尽，设置每开始一个 IP 的探测任务后等待一小段时间，单位毫秒。若不指定则默认为 `1000`。
- `--roundInterval`：每一轮完成后等待的时间，单位秒。若不指定则默认为 `60`。

示例：

```shell
./nts-offset --round 2 --input /data/ips.txt --output /data/offset.txt --interval 1000 --roundInterval 60
```

## 输出结果

输出结果保存在 `output` 所指定的文件中。文件的每一行均表示对一个安全 NTPv4 服务器的有效探测结果。每行包含的字段有：
- IP 地址
- 类别字符串
- 不使用 NTS 的 offset
- 使用 SIV_CMAC_256 的 offset
- 使用 SIV_CMAC_256 且以请求发送的时刻作为 T1 的 offset
- 使用 SIV_CMAC_384 的 offset
- 使用 SIV_CMAC_384 且以请求发送的时刻作为 T1 的 offset
- 使用 SIV_CMAC_512 的 offset
- 使用 SIV_CMAC_512 且以请求发送的时刻作为 T1 的 offset

类别字符串由三个 `Y` 或 `N` 组成，分别表示「证书的 CN 解析结果是否与 IP 地址一致」、「证书是否处于有效期内」、「是否支持第二阶段的 NTS」。

上述 offset 值单位均为毫秒，保留三位小数。如果相关数据缺失则使用 `-` 代替。

例如，某个 offset 为 `-1000.000` 表示服务器的时间比本地时间慢 1 秒。

相邻字段间用制表符 `\t` 进行分隔。例如：

```
69.89.207.99	-89.274	-84.555	-84.555	-89.808	-90.079	-83.369	-83.369
```